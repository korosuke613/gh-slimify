# This is a test workflow file for integration testing.
# GitHub Actions is disabled for this workflow.
name: Integration Test - Conditional Execution_test

on:
  push:
    branches:
      - 'never-run-this-workflow'
  pull_request:
    branches:
      - 'never-run-this-workflow'

env:
  NODE_ENV: test
  TEST_TIMEOUT: 300

jobs:
  conditional-test:
    name: Conditional Test
    runs-on: ubuntu-latest
    if: github.event_name != 'schedule' || github.ref == 'refs/heads/main'
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      
      - name: Check event type
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Ref: ${{ github.ref }}"
          echo "Actor: ${{ github.actor }}"
      
      - name: Run on push
        if: github.event_name == 'push'
        run: echo "Running on push event"
      
      - name: Run on pull request
        if: github.event_name == 'pull_request'
        run: echo "Running on pull request event"
      
      - name: Run on schedule
        if: github.event_name == 'schedule'
        run: echo "Running scheduled job"

  multi-job-workflow:
    name: Multi-Job Workflow
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      
      - name: Setup environment
        id: setup
        run: |
          echo "Setting up test environment"
          echo "NODE_ENV=${{ env.NODE_ENV }}"
          echo "TEST_TIMEOUT=${{ env.TEST_TIMEOUT }}"
          echo "result=success" >> $GITHUB_OUTPUT
    
    outputs:
      test-result: ${{ steps.setup.outputs.result }}

  dependent-job:
    name: Dependent Job
    runs-on: ubuntu-latest
    needs: multi-job-workflow
    if: always()
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      
      - name: Run dependent test
        run: |
          echo "Previous job status: ${{ needs.multi-job-workflow.result }}"
          echo "Running dependent test"

# Expected results when running 'gh slimfy':
# - 3 candidate jobs detected: conditional-test, multi-job-workflow, dependent-job
#   - conditional-test: runs-on: ubuntu-latest ✓, no Docker/containers/services ✓
#   - multi-job-workflow: runs-on: ubuntu-latest ✓, no Docker/containers/services ✓
#   - dependent-job: runs-on: ubuntu-latest ✓, no Docker/containers/services ✓
# - Output: ".github/workflows/_test_conditional_test.yml\n  - job \"conditional-test\" (L20) → ubuntu-slim compatible\n  - job \"multi-job-workflow\" (L46) → ubuntu-slim compatible\n  - job \"dependent-job\" (L64) → ubuntu-slim compatible\n\nTotal: 3 job(s) can be safely migrated."

